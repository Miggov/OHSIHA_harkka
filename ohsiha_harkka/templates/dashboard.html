<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"
   integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
   crossorigin=""/>
   <style>#mapid { height: 400px; }</style>
    <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"
   integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="
   crossorigin=""></script>
  </head>
  <body>
    <!--[if lt IE 7]>
      <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="#">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->
    <div id="managebuttons">
      <form action = "app/update" method = "get" id = "update"> 
        <input type = "submit" class = "button" id = "button1" value = "Lataa tiedot rajapinnasta" name = "updateAPI"></form>
        <p></p>
    </div>
    <div id="mapid">
      <script>
        function load_data() {
          fetch('http://127.0.0.1:8000/app/TrafficLights')
            .then(res => res.json())
            .then(data => TrafficLights = data)
            .then(function(TrafficLights){
              //let bounds = mymap.getBounds();
              for (let i=0;i<TrafficLights.length;i++){
                let status = TrafficLights[i]['status'];
                console.log(status);
                let lat = parseFloat(TrafficLights[i]['coordinate_x']);
                let lon = parseFloat(TrafficLights[i]['coordinate_y']);
                let circle = L.circle([lat, lon], {
                  color: status,
                  fillOpacity: 1,
                  radius: 5}).addTo(mymap);
                //let latlon = L.latlng(lat, lon);
               // console.log('iltua');
              //  if (bounds.contains(latlon)){ 
               // }
              }
            })
        }

        var mymap = L.map('mapid').setView([61.448357, 23.854091], 17); //Setting default centerplace for the map

        // Loading gmaps layer
        googleStreets = L.tileLayer('http://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}',{ 
          maxZoom: 20,
          subdomains:['mt0','mt1','mt2','mt3']
      }).addTo(mymap);

    
        mymap.on('moveend', load_data);
        load_data();
      </script>
    </div>

    <div id="forecast">
      <iframe src="http://forecabox.foreca.com/get/43928" width="300" height="250" marginwidth="0" marginheight="0" frameborder="0" scrolling="no" allowtransparency="true"></iframe>
    </div>

  </body>
</html>